---
title: Speed to Answer
author: "Sam Castillo and Brian A. Fannin"
date: September XX, 2019
output: 
  revealjs::revealjs_presentation:
    center: false
    transition: none
    css: css/custom.css
    self_contained: yes
    reveal_options:
      slideNumber: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    echo = FALSE
  , warning = FALSE
  , message = FALSE
  , collapse = TRUE
  , cache = TRUE
)

library(tidyverse)
library(gridExtra)
library(vroom)
library(ggthemes)
library(png)
library(grid)

source("theme_soa.R")
```

```{r}
my_void <- theme_void() +
  theme(
    text = element_text(size = 20)
    , legend.position = 'none'
  )

my_minimal <- theme_minimal() +
  theme(
    text = element_text(size = 20)
  )

my_classic <- theme_classic() + 
  theme(
    text = element_text(size = 20)
  )

my_percent <- function(x) {
  scales::percent(x, accuracy = 0.1)
}

my_args <- list(big.mark = ',', digits = 0, scientific = FALSE)
```

##

* Visual perception uses graphical space more efficiently than tabular data
* Statistical models are easier to refute visually
* The only useful graphics are ones that people look at
* Speed to production

# Spatial efficiency

## {data-background=white}

## {.gigantic-text}

9 

## {.center}

Which of these two numbers is larger? 

##

<div class = 'left very-large-text'>
11
</div>

<div class = 'right very-large-text'>
9
</div>

## {.center}

How about these two?

##

<div class = 'left large-text'>
1011
</div>

<div class = 'right large-text'>
1001
</div>

## {.center}

These?

##

<div class = 'left very-large-text'>
9
</div>

<div class = 'right very-large-text'>
B
</div>

## {.center}

And these?

##

<div class = 'left very-large-text'>
IX
</div>

<div class = 'right very-large-text'>
XI
</div>

## {.center}

These?

##

<div class = 'left large-text'>
十一
</div>

<div class = 'right large-text'>
九
</div>

## {.center}

How about these?

##

```{r}
tibble(
    val = c('left', 'right')
  , size = c(11, 9)
) %>% 
  ggplot(
    aes(val, size)
  ) + 
  geom_bar(position = 'dodge', stat = 'identity') + 
  my_void
```

## {.center}

nine

9

neun

1001

九

IX

nueve

##  {.center}

Arabic or sanskrit are no more legitimate than any other representation of numbers.

## This is actually _too much_ information

```{r}
tibble(
    val = c('left', 'right')
  , size = c(11, 9)
) %>% 
  ggplot(
    aes(val, size)
  ) + 
  geom_bar(position = 'dodge', stat = 'identity') + 
  my_void
```

## This is better

```{r fig.width=4}
tibble(
    val = c('left', 'right')
  , size = c(11, 9)
) %>% 
  ggplot(
    aes(val, size)
  ) + 
  geom_bar(position = 'dodge', stat = 'identity', width = 0.1) + 
  my_void
```

##

Statistics maps a set of many numbers into a set of fewer numbers.

```{r}
set.seed(1234)
mean <- 10e3
cv <- 0.3
sigma <- sqrt(log(1 + cv^2))
mu <- log(mean) - sigma^2/2

tbl_obs <- tibble(
  x = rlnorm(5e3, mu, sigma)
  , y = rgamma(5e3, 1 / cv^2, scale = mean * cv ^ 2)
)

tbl_obs_long <- tbl_obs %>% 
  tidyr::gather(sample, value)

tbl_obs <- tbl_obs %>% 
  mutate(
    yen = x * 137
  )

summary_x <- tbl_obs$x %>% 
  summary()

summary_y <- tbl_obs$y %>% 
  summary()

summary_yen <- tbl_obs$yen %>% 
  summary()

tbl_summary <- data.frame(
  metric = names(summary_x)
  , x = summary_x %>% as.numeric()
  , y = summary_y %>% as.numeric()
  , yen = summary_yen %>% as.numeric()
)
```

```{r}
mean_sample <- tbl_obs$x %>% mean()
sd_sample <- tbl_obs$x %>% sd()
```

```{r }
tbl_obs$x %>% 
  summary()
```

## {.center}

```{r }
tbl_summary %>%
  select(metric, x) %>% 
  knitr::kable(
    format.args = my_args
  )
```

## 

```{r}
plt_base <- tbl_obs %>% 
  ggplot(aes(x))

plt_hist <- plt_base + 
  geom_histogram(
      aes(y = stat(density))
    , fill = 'grey'
    , color = 'black')

plt_density <- plt_base + 
  geom_density(fill = 'grey')

grid.arrange(
    nrow = 1
  , plt_hist
  , plt_density
)
```

## 

```{r}
mean_x <- tbl_obs$x %>% mean()

grid.arrange(
    nrow = 1
  , plt_hist + geom_vline(xintercept = mean_x, color = 'red')
  , plt_density + geom_vline(xintercept = mean_x, color = 'red')
)
```

##

```{r}
conf_95 <- quantile(tbl_obs$x, c(.05, .95))

grid.arrange(
    nrow = 1
  , plt_hist + 
      geom_vline(xintercept = mean_x, color = 'red') + 
      geom_vline(xintercept = conf_95, color = 'black', alpha = 0.6)
  , plt_density + geom_vline(xintercept = mean_x, color = 'red')  + 
      geom_vline(xintercept = conf_95, color = 'black', alpha = 0.6)
)
```

##

<div class = 'left'>

```{r }
tbl_summary %>% 
  select(metric, x) %>% 
  knitr::kable(
    format.args = my_args
  )
```

</div>

<div class = 'right'>

```{r fig.height = 8}
plt_hist + 
  geom_vline(xintercept = mean_x, color = 'red') + 
  geom_vline(xintercept = conf_95, color = 'black', alpha = 0.6)
```

</div>

## {.center}

Summary statistics are _always_ a reduction of information.

Visualization presents (almost) _all_ of the data. The reductions are made with our eyes.

## {.center}

- Potential complaint: 
- Focus on visual design places undue emphasis on superfluous characteristics like color, font, etc.

## {.center}

What's the most important word in the text which follows?

##

The rate for territory X must be **increased** by 10.4%.

## {.center}

And this one?

##

The rate for **territory** X must be increased by 10.4%.

## {.center}

"Inessential" matters. Emphasis is an element of communication and therefore comprehension.

## {.center .unprofessional}

This year we expect to turn the corner on profitability.

# Productivity

1. Branding your data visualizations
2. Producing graphs quickly
3. 

## Data visualization communicates your brand

* Your customers and clients judge your product based on appearance
* When writing a resume, professionalism matters

## Default graphics

```{r}
iris %>% 
  ggplot(aes(Sepal.Width, Sepal.Length, color = Species)) + 
  geom_point()
```

## Professional graphics

```{r }
img <- readPNG("images/soa_logo.png")
logo <- rasterGrob(img, interpolate = T)

qplot(1:10, 1:10, geom = "blank") + 
  annotation_custom(logo) 

gg <- iris %>% 
  ggplot(aes(Sepal.Width, Sepal.Length, color = Species)) + 
  geom_point(size = 2) + 
  theme_classic() + 
  labs("") + 
  theme(legend.position = "top") + 
  xlab("X Label") + 
  ylab("Y Label") +
  theme_soa() + 
  ggtitle("FivethirtyEight theme") + 
  labs( subtitle = "Based on fivethirtyeight's theme \nfrom the 'ggthemes' package",
        caption = "Copyright 2019 YourBrandName \nUsed without Permission") + 
   annotation_custom(logo, ymin = 8.5, ymax = 9, xmin = 4, xmax = 4.5) 

gt <- ggplot_gtable(ggplot_build(gg))
gt$layout$clip[gt$layout$name == "panel"] <- "off"
grid.draw(gt)
```

## What should actuaries look for?

* Readability
* Honesty - it should be representative of the underlying data
* Reference ASOP

## Bad - Difficult to read

* What are the units?
* What are the X and Y axis?
* What is the data source?

```{r fig.height=4}
readmissions <- read_csv("data/hospital_readmission_rates.csv", na = "Not Available")

readmissions %>% 
  ggplot(aes(`Number of Readmissions`)) + 
  geom_histogram() +
  ggtitle("Hospital Readmissions")
```

## Good example - easy to read

* There are just over 2,000 hospitals with between 30 and 50 readmissions
* There are 4,000 hospitals with between 10 and 30 

```{r fig.height=4}
readmissions %>% 
  ggplot(aes(`Number of Readmissions`)) + 
  geom_histogram(binwidth = 20, color = "Light Grey", size = 1.2) + 
  xlim(0, 300) + 
  theme_soa() + 
  ggtitle("Distribution of Hospital Readmissions") + 
  xlab("Number of Readmissions") + 
  ylab("Number of Hospitals") + 
  labs( subtitle = "Based on Five Thirty Eight's Theme \nfrom the 'ggthemes' package",
        caption = "Copyright 2019 YourBrandName \nData Source: HealthData.gov") + 
   annotation_custom(logo, ymin = 8.5, ymax = 9, xmin = 4, xmax = 4.5) + 
  scale_x_continuous(breaks = seq(10, 300, 20),minor_breaks = seq(0, 300, 10), limits = c(0, 300))
```

## Bad example - Excel mixed type graph

* Which axis is the Actual and which is the Predicted?  
* The blue bars take up more visual space than the lines, but both units are equally important
* The lines do not even make sense because there is no continuous scale (States are not related to each other)

![*Excel Mixed Type Graph*](images/excel_pivot_1.PNG)

## Bad example - Excel mixed type graph

<div class = 'left'>

* Which axis is the Actual and which is the Predicted?  
* The blue bars take up more visual space than the lines, but both units are equally important
* The lines do not even make sense because there is no continuous scale (States are not related to each other)

</div>

<div class = 'right'>

![*Excel Mixed Type Graph*](images/excel_pivot_1.PNG)

</div>

## Good example - box plot of AvE ratio

```{r }
readmissions %>% 
  filter(State %in% c("IL", "MA", "NC", "NY", "PA")) %>% 
  mutate(ave = `Expected Readmission Rate`/`Predicted Readmission Rate`) %>% 
  ggplot(aes(State, ave, fill = State)) + 
  geom_boxplot(outlier.alpha = 0.2, alpha = 0.7) + 
  coord_flip() + 
  theme_soa() + 
  ggtitle("Actual vs Expected Readmission Ratio") + 
  ylab("Actual/Predicted") +
  labs( subtitle = "Based on Five Thirty Eight's Theme \nfrom the 'ggthemes' package",
        caption = "Copyright 2019 YourBrandName \nData Source: HealthData.gov") + 
  annotation_custom(logo, ymin = 8.5, ymax = 9, xmin = 4, xmax = 4.5) 
```

## How to create graphics like this quickly

Creating a graph is an assembly line

1.  Get data in the right format
2.  Explore an idea - Discovery is a spontaneous process
3.  Plot a graph
4.  Put it in front of people

# Conclusion

## 

* Bullet 1
* Bullet 2

## {.center}

Thank you!

## Where to find this

This presentation may be found at: http://pirategrunt.com/soa_symposium_2019/

Code to produce the examples and slides: https://github.com/PirateGrunt/soa_symposium_2019